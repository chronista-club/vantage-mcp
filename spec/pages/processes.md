# プロセス管理ページ - 仕様書

## 目的

Vantage MCP で管理する複数のプロセスの**状態を瞬時に把握**し、起動・停止・削除などの操作を直感的に実行できるページ。

### 解決する課題

- **可視性の欠如**: 複数プロセスの状態を個別に確認するのは非効率
- **操作の煩雑さ**: CLI での個別操作は時間がかかる
- **状態把握の遅延**: ログを追わないと異常に気づけない

## ユースケース

### UC-001: 日常の監視

**Actor**: 開発者

**Goal**: 開発環境の複数プロセス（フロントエンド、バックエンド、DB など）の状態を一目で確認したい

**Flow**:
1. プロセス一覧ページを開く
2. 各プロセスの状態（Running/Stopped/Failed）が色分けされて表示される
3. 異常があれば即座に視認できる

**Success Criteria**: 6 つのプロセス状態を **2 秒以内**に把握できる

### UC-002: インシデント対応

**Actor**: DevOps エンジニア

**Goal**: エラーが発生したプロセスを即座に特定し、再起動したい

**Flow**:
1. プロセス一覧で Failed 状態のプロセスを視認
2. そのプロセスの詳細を確認（エラーログ）
3. 停止 → 起動で再起動
4. 状態が Running に戻ることを確認

**Success Criteria**: 特定から再起動完了まで **30 秒以内**

### UC-003: バッチ操作

**Actor**: 開発者

**Goal**: 関連する複数プロセスをまとめて起動/停止したい

**Flow**:
1. プロセス一覧で複数プロセスを選択
2. 「まとめて起動」ボタンをクリック
3. 選択したプロセスが順次起動される

**Success Criteria**: 10 プロセスの一括起動が **従来の 1/3 の時間**で完了

### UC-004: 3D 可視化による把握

**Actor**: データエンジニア

**Goal**: プロセス間の依存関係をビジュアルに把握したい

**Flow**:
1. 3D グラフモードに切り替え
2. プロセスがノードとして表示され、依存関係がエッジで表現される
3. カメラを回転・ズームして全体像を把握

**Success Criteria**: 20 プロセスの依存関係を **5 秒以内**に理解できる

## 機能要件

### FR-001: プロセス一覧表示（必須）

- **説明**: 管理中の全プロセスをリスト表示
- **表示項目**:
  - プロセス ID
  - プロセス名
  - 状態（Running / Stopped / Failed）
  - 起動時刻
  - PID（実行中の場合）
  - コマンド
- **ソート**: 名前、状態、起動時刻でソート可能
- **フィルター**: 状態でフィルタリング可能

### FR-002: プロセス操作（必須）

- **起動**: Stopped 状態のプロセスを起動
- **停止**: Running 状態のプロセスを停止
- **削除**: プロセスを管理対象から削除
- **再起動**: 停止 → 起動を連続実行

### FR-003: リアルタイム状態更新（必須）

- **説明**: プロセス状態の変化を自動的にUIに反映
- **ポーリング間隔**: 2 秒（設定可能）
- **WebSocket 対応**: 将来的にプッシュ通知に移行

### FR-004: 詳細表示（必須）

- **説明**: プロセスをクリックすると詳細情報を表示
- **表示項目**:
  - 環境変数
  - 作業ディレクトリ
  - 引数
  - stdout/stderr ログ（最新 100 行）

### FR-005: 3D 可視化（オプション）

- **説明**: プロセスを 3D 空間に配置して可視化
- **ビューモード**:
  - **List Mode**: 縦一列に整列（監視向け）
  - **Graph Mode**: 循環ネットワーク配置（依存関係可視化）
  - **Control Mode**: グリッド配置（操作向け）
  - **Edit Mode**: フォーカス + コンテキスト（編集向け）

### FR-006: 一括操作（オプション）

- **説明**: 複数プロセスを選択して一括操作
- **操作**: 起動、停止、削除
- **UI**: チェックボックスで複数選択

### FR-007: プロセス作成（必須）

- **説明**: 新しいプロセスを登録
- **入力項目**:
  - プロセス ID（一意）
  - コマンド
  - 引数（配列）
  - 環境変数（キー・バリュー）
  - 作業ディレクトリ
  - 自動起動フラグ

### FR-008: テンプレートからの作成（オプション）

- **説明**: テンプレートを使って迅速にプロセスを作成
- **Flow**: テンプレート選択 → パラメータ入力 → 作成

## 非機能要件

### NFR-001: パフォーマンス

- **初期ロード**: 100 プロセスの一覧表示を 1 秒以内
- **状態更新**: ポーリングによる UI 更新のオーバーヘッドは 50ms 以内
- **3D レンダリング**: 60 FPS を維持（100 プロセスまで）

### NFR-002: レスポンシブデザイン

- **デスクトップ**: 1920x1080 以上で最適化
- **タブレット**: 768x1024 で操作可能
- **モバイル**: 375x667 で基本機能が利用可能（3D は無効化）

### NFR-003: アクセシビリティ

- **キーボード操作**: Tab キーでナビゲーション、Enter で実行
- **スクリーンリーダー**: ARIA ラベルでプロセス状態を読み上げ
- **カラーコントラスト**: WCAG 2.1 AA レベル準拠

### NFR-004: 多言語対応

- **サポート言語**: 日本語、英語
- **切り替え**: 設定ページで変更
- **フォールバック**: 未翻訳の場合は英語を表示

## 設計

### UI コンポーネント構成

```
ProcessesView.vue
├── ProcessFilters.vue (フィルター・ソート)
├── ViewModeSwitch.vue (2D/3D 切り替え)
├── ProcessList.vue (2D モード)
│   └── ProcessCard.vue × N
│       ├── ProcessStatus.vue
│       └── ProcessActions.vue
└── Process3DGraph.vue (3D モード)
    └── LayoutManager.ts (レイアウト計算)
```

### 状態管理（Pinia）

```typescript
// stores/process.ts
interface ProcessState {
  processes: Map<string, Process>;
  selectedProcessIds: Set<string>;
  filters: {
    status: ProcessStatus | null;
    searchQuery: string;
  };
  viewMode: '2d' | '3d';
  layout3D: '3d-list' | '3d-graph' | '3d-control' | '3d-edit';
}

actions:
- fetchProcesses()
- startProcess(id)
- stopProcess(id)
- deleteProcess(id)
- toggleSelection(id)
- setFilter(key, value)
- switchViewMode(mode)
```

### API エンドポイント

```
GET  /api/processes          - プロセス一覧取得
POST /api/processes          - プロセス作成
GET  /api/processes/:id      - プロセス詳細取得
POST /api/processes/:id/start - プロセス起動
POST /api/processes/:id/stop  - プロセス停止
DELETE /api/processes/:id     - プロセス削除
GET  /api/processes/:id/logs  - ログ取得
```

### 3D 可視化設計

**技術スタック**:
- **Three.js**: WebGL レンダリング
- **TWEEN.js**: アニメーション
- **LayoutManager.ts**: レイアウト計算とビューモード管理

**状態の視覚表現**:
- **Running**: Creative Magenta (`oklch(0.65 0.25 330)`) + パルスアニメーション
- **Stopped**: Provision Cyan (`oklch(0.85 0.10 195)`)
- **Failed**: Bradcast Pink (`oklch(0.70 0.20 320)`) + 点滅アニメーション

**インタラクション**:
- **ホバー**: プロセス情報をツールチップ表示
- **クリック**: 詳細モーダルを開く
- **右クリック**: コンテキストメニュー（起動/停止/削除）

## テストケース

### TC-001: プロセス一覧表示

**前提**: 5 つのプロセスが登録されている（3 Running, 1 Stopped, 1 Failed）

**操作**: ページを開く

**期待結果**:
- 5 つのプロセスカードが表示される
- Running は緑、Stopped は青、Failed は赤で表示される
- 起動時刻が新しい順に並んでいる

### TC-002: プロセス起動

**前提**: プロセス "test-server" が Stopped 状態

**操作**: "起動" ボタンをクリック

**期待結果**:
- API `POST /api/processes/test-server/start` が呼ばれる
- 状態が Running に変わる
- PID が表示される

### TC-003: プロセス削除（確認ダイアログ）

**前提**: プロセス "old-job" が Stopped 状態

**操作**: "削除" ボタンをクリック → 確認ダイアログで "OK"

**期待結果**:
- 確認ダイアログが表示される
- OK 後、API `DELETE /api/processes/old-job` が呼ばれる
- プロセスが一覧から消える

### TC-004: フィルター（状態）

**前提**: 10 プロセス（5 Running, 3 Stopped, 2 Failed）

**操作**: 状態フィルターで "Running" を選択

**期待結果**:
- 5 つの Running プロセスのみが表示される

### TC-005: 3D モード切り替え

**前提**: 2D リストモードで表示中

**操作**: ビューモードスイッチで "3D Graph" を選択

**期待結果**:
- 3D シーンがレンダリングされる
- プロセスが循環ネットワーク配置で表示される
- 800ms のトランジションアニメーション

### TC-006: エラーハンドリング（起動失敗）

**前提**: プロセス "broken-app" のコマンドが不正

**操作**: "起動" ボタンをクリック

**期待結果**:
- API がエラーを返す
- トースト通知でエラーメッセージを表示
- 状態は Failed に変わる

## 制約

### 技術的制約

- **ブラウザ**: Chrome 90+, Firefox 88+, Safari 14+（WebGL 2.0 対応）
- **3D レンダリング**: 100 プロセスまで（パフォーマンス上限）
- **ログ表示**: 最新 100 行まで（メモリ節約）

### ビジネス制約

- **同時操作**: 複数ユーザーが同時に操作する可能性は低い（単一開発者向け）
- **セキュリティ**: ローカル開発環境での使用を想定（認証なし）

## 今後の拡張

- **プロセス依存関係の定義**: "A が起動したら B を起動" のような依存関係
- **プロセスグループ**: 複数プロセスをグループ化して一括管理
- **プロセステンプレートのインポート/エクスポート**: JSON/YAML で共有
- **WebSocket によるリアルタイム更新**: ポーリングからプッシュへ移行
- **VR/AR 対応**: WebXR を使って没入型可視化

## 更新履歴

| 日付 | 変更者 | 変更内容 | 理由 |
|------|--------|----------|------|
| 2025-11-02 | Claude Code | 初版作成 | 仕様の明確化 |
