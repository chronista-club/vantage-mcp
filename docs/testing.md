# Vantageã‚µãƒ¼ãƒãƒ¼ã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

## ãƒ†ã‚¹ãƒˆæ¦‚è¦

Vantageã‚µãƒ¼ãƒãƒ¼ã«ã¯ä»¥ä¸‹ã®ãƒ†ã‚¹ãƒˆãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ï¼š

### 1. Web APIãƒ†ã‚¹ãƒˆï¼ˆâœ… å‹•ä½œç¢ºèªæ¸ˆã¿ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `crates/vantage/tests/test_web_api.rs`

**å®Ÿè¡Œæ–¹æ³•**:
```bash
cargo test --test test_web_api --features web
```

**ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**:
- âœ… ã‚µãƒ¼ãƒãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾— (`GET /status`)
- âœ… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿å–å¾— (`GET /dashboard`)
- âœ… ãƒ—ãƒ­ã‚»ã‚¹ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«
  - ãƒ—ãƒ­ã‚»ã‚¹ä½œæˆ (`POST /processes`)
  - ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§ (`GET /processes`)
  - ãƒ—ãƒ­ã‚»ã‚¹èµ·å‹• (`POST /processes/:id/start`)
  - ãƒ—ãƒ­ã‚»ã‚¹ãƒ­ã‚°å–å¾— (`GET /processes/:id/logs`)
  - ãƒ—ãƒ­ã‚»ã‚¹å‰Šé™¤ (`DELETE /processes/:id`)
- âœ… ãƒ—ãƒ­ã‚»ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆçŠ¶æ…‹ã€åå‰ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

**å®Ÿè£…ã®ç‰¹å¾´**:
- å®Ÿéš›ã®HTTPã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¦ãƒ†ã‚¹ãƒˆ
- Axum + reqwestã«ã‚ˆã‚‹çµ±åˆãƒ†ã‚¹ãƒˆ
- ä¸¦è¡Œå®Ÿè¡Œã‚’é¿ã‘ã‚‹ãŸã‚`--test-threads=1`ã‚’æ¨å¥¨

**ãƒ†ã‚¹ãƒˆçµæœ**:
```
running 4 tests
test test_dashboard_endpoint ... ok
test test_get_status ... ok
test test_process_filtering ... ok
test test_process_lifecycle_api ... ok

test result: ok. 4 passed; 0 failed
```

### 2. ãƒ–ãƒ©ã‚¦ã‚¶E2Eãƒ†ã‚¹ãƒˆï¼ˆâœ… Chrome MCP DevToolsç‰ˆï¼‰

**æ¨å¥¨æ–¹æ³•**: Chrome MCP DevToolsã‚’ä½¿ç”¨ã—ãŸå¯¾è©±çš„E2Eãƒ†ã‚¹ãƒˆ

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `docs/testing-chrome-mcp.md`

**å®Ÿè¡Œæ–¹æ³•**:
Claude Codeã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§MCPãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨
```bash
# 1. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
cargo run --bin vantage -- --web --web-port 12700

# 2. Chrome MCPãƒ„ãƒ¼ãƒ«ã§æ“ä½œ
# - mcp__chrome-devtools__new_page
# - mcp__chrome-devtools__take_snapshot
# - mcp__chrome-devtools__click
# - mcp__chrome-devtools__take_screenshot
```

**ãƒ†ã‚¹ãƒˆé …ç›®**:
- âœ… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
- âœ… ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§è¡¨ç¤º
- âœ… ãƒ—ãƒ­ã‚»ã‚¹ä½œæˆãƒ»èµ·å‹•ãƒ»åœæ­¢
- âœ… ãƒ­ã‚°è¡¨ç¤º
- âœ… çµ±è¨ˆæƒ…å ±ã®æ›´æ–°

**åˆ©ç‚¹**:
- ä¾å­˜é–¢ä¿‚ä¸è¦ï¼ˆMCPã‚µãƒ¼ãƒãƒ¼ä½¿ç”¨ï¼‰
- è¦–è¦šçš„ç¢ºèªãŒå®¹æ˜“ï¼ˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼‰
- ãƒ‡ãƒãƒƒã‚°ãŒç°¡å˜ï¼ˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼‰
- ä¿å®ˆæ€§ãŒé«˜ã„

**å®Ÿè¡Œçµæœ**: å…¨é …ç›®æˆåŠŸï¼ˆ2025-10-08å®Ÿæ–½ï¼‰

---

### 2-alt. ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆï¼ˆheadless_chromeç‰ˆãƒ»éæ¨å¥¨ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `crates/vantage/tests/test_browser.rs`

**æ³¨æ„**: Chrome MCPç‰ˆã‚’æ¨å¥¨ã€‚ã“ã®æ–¹å¼ã¯åˆ¶ç´„ãŒå¤šã„ã€‚

**åˆ¶ç´„äº‹é …**:
- headless_chromeã«ä¾å­˜ï¼ˆChromiumãŒå¿…è¦ï¼‰
- ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã§ã¯å®Œå…¨ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ã‚¿ãƒ¼ãŒå¿…è¦
- ç¾çŠ¶ã€`create_app`é–¢æ•°ãŒå…¬é–‹ã•ã‚Œã¦ã„ãªã„ãŸã‚å‹•ä½œã—ãªã„

### 3. æ—¢å­˜ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ»çµ±åˆãƒ†ã‚¹ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**:
- `crates/vantage/tests/test_integration.rs` - ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã®çµ±åˆãƒ†ã‚¹ãƒˆ
- `crates/vantage/tests/test_process_update.rs` - ãƒ—ãƒ­ã‚»ã‚¹æ›´æ–°ã®ãƒ†ã‚¹ãƒˆ

**å®Ÿè¡Œæ–¹æ³•**:
```bash
cargo test
```

## æ¨å¥¨ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### é–‹ç™ºæ™‚
```bash
# å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
cargo test

# APIãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
cargo test --test test_web_api --features web
```

### CI/CD
```bash
# å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆã‚’é™¤ãï¼‰
cargo test --features web

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
cargo fmt -- --check

# Lintãƒã‚§ãƒƒã‚¯
cargo clippy -- -D warnings
```

## ãƒ†ã‚¹ãƒˆã®æ‹¡å¼µ

### æ–°ã—ã„APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ ã—ãŸå ´åˆ

1. `test_web_api.rs`ã«æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ 
2. ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æ­£å¸¸ç³»ã¨ç•°å¸¸ç³»ã‚’ä¸¡æ–¹ãƒ†ã‚¹ãƒˆ
3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã‚’æ¤œè¨¼

### ä¾‹ï¼šæ–°ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
```rust
#[tokio::test]
async fn test_template_crud() {
    // 1. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ
    // 2. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§å–å¾—
    // 3. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°
    // 4. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šé™¤
}
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒãƒ¼ãƒˆç«¶åˆã‚¨ãƒ©ãƒ¼
ã‚µãƒ¼ãƒãƒ¼ã¯è‡ªå‹•çš„ã«ç©ºã„ã¦ã„ã‚‹ãƒãƒ¼ãƒˆã‚’æ¢ã—ã¾ã™ãŒã€ä¸¦è¡Œãƒ†ã‚¹ãƒˆã‚’é¿ã‘ã‚‹ãŸã‚ï¼š
```bash
cargo test --test test_web_api -- --test-threads=1
```

### ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼
ãƒ†ã‚¹ãƒˆã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å»¶é•·ï¼š
```rust
tokio::time::sleep(Duration::from_secs(2)).await;
```

## ã¾ã¨ã‚

- âœ… **APIãƒ†ã‚¹ãƒˆ**: æœ¬ç•ªãƒ¬ãƒ™ãƒ«ã®å“è³ªä¿è¨¼ã«ååˆ†
- ğŸš§ **ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆ**: ç¾æ™‚ç‚¹ã§ã¯åˆ¶ç´„ã‚ã‚Šã€æ‰‹å‹•ãƒ†ã‚¹ãƒˆã‚’æ¨å¥¨
- ğŸ¯ **ä»Šå¾Œ**: E2Eãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆPlaywrightç­‰ï¼‰ã®å°å…¥ã‚’æ¤œè¨
