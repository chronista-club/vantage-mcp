[tools]
bun = "latest"

[tasks."web:install"]
description = "Web UIã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
dir = "ui/web"
run = "bun install"

[tasks.build-web]
description = "Bunã§Web UIã‚’ãƒ“ãƒ«ãƒ‰"
depends = ["web:install"]
dir = "ui/web"
run = "bun run build"

[tasks.web]
description = "Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä»˜ãã§Vantageã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè¡Œ"
run = "RUST_LOG=info cargo run --bin vantagemcp -- --web-only"

[tasks.dev]
description = "Webã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰å¾Œã€Vantageã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè¡Œ"
depends = ["build-web"]
run = "RUST_LOG=info cargo run --bin vantagemcp -- --web-only"

[tasks.dev-watch]
description = "è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰ä»˜ãé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼ˆRust + Webï¼‰"
run = """
    # Kill any existing processes
    pkill -f 'cargo run.*vantagemcp' || true
    # Start cargo-watch for Rust code auto-reload
    cargo watch -x 'run --bin vantagemcp -- --web-only' &
    # Store PID for cleanup
    CARGO_PID=$!
    echo "Started cargo-watch with PID: $CARGO_PID"
    # Wait for SIGTERM
    trap "kill $CARGO_PID 2>/dev/null || true" EXIT
    wait
"""

[tasks.web-watch]
description = "Webã‚¢ã‚»ãƒƒãƒˆã®ã¿ã‚’ç›£è¦–ã—ã¦ãƒ“ãƒ«ãƒ‰"
dir = "ui/web"
run = "bun run build --watch"

# ãƒ­ãƒ¼ã‚«ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¿ã‚¹ã‚¯
[tasks.install]
description = "ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰å¾Œã€~/.local/binã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
depends = ["build"]
run = """
    mkdir -p ~/.local/bin
    cp target/release/vantagemcp ~/.local/bin/
    chmod +x ~/.local/bin/vantagemcp
    echo "âœ… Installed to ~/.local/bin/vantagemcp"
    ~/.local/bin/vantagemcp --version
"""

[tasks.install-debug]
description = "ãƒ‡ãƒãƒƒã‚°ãƒ“ãƒ«ãƒ‰ã‚’~/.local/binã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆé«˜é€Ÿï¼‰"
depends = ["build-debug"]
run = """
    mkdir -p ~/.local/bin
    cp target/debug/vantagemcp ~/.local/bin/
    chmod +x ~/.local/bin/vantagemcp
    echo "âœ… Installed debug build to ~/.local/bin/vantagemcp"
    ~/.local/bin/vantagemcp --version
"""

[tasks.build]
description = "ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰"
depends = ["build-web"]
run = "cargo build --release"

[tasks.build-and-install]
description = "UIã‚’ãƒ“ãƒ«ãƒ‰å¾Œã€Rustãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰ã—ã€cargo installã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
depends = ["build-web"]
run = """
    echo "ğŸ”¨ Step 1/3: UIãƒ“ãƒ«ãƒ‰å®Œäº† âœ“"
    echo ""
    echo "ğŸ”¨ Step 2/3: Rustãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰ä¸­..."
    cargo build --release
    echo "âœ… Rustãƒ“ãƒ«ãƒ‰å®Œäº†"
    echo ""
    echo "ğŸ”¨ Step 3/3: cargo installã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
    cargo install --path crates/vantage-mcp --force
    echo ""
    echo "âœ… ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†!"
    echo ""
    echo "ğŸ“ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆ: $(which vantagemcp)"
    vantagemcp --version || true
    echo ""
    echo "ä½¿ç”¨æ–¹æ³•:"
    echo "  vantagemcp              # Vantage MCPã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•"
    echo "  vantagemcp --no-open    # ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‹ã‹ãšã«èµ·å‹•"
    echo ""
    if pgrep -f vantagemcp > /dev/null; then
        echo "âš ï¸  å®Ÿè¡Œä¸­ã®Vantageãƒ—ãƒ­ã‚»ã‚¹ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ"
        echo "å†èµ·å‹•ã™ã‚‹å ´åˆ: pkill -f vantagemcp && vantagemcp"
    fi
"""

[tasks.build-debug]
description = "ãƒ‡ãƒãƒƒã‚°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰"
depends = ["build-web"]
run = "cargo build"

[tasks.test]
description = "å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ"
run = "cargo test"

[tasks.check]
description = "ãƒ“ãƒ«ãƒ‰ã›ãšã«ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯"
run = "cargo check"

[tasks.clean]
description = "ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’ã‚¯ãƒªãƒ¼ãƒ³"
run = "cargo clean"

[tasks.uninstall]
description = "~/.local/binã‹ã‚‰vantagemcpã‚’å‰Šé™¤"
run = """
    if [ -f ~/.local/bin/vantagemcp ]; then
        rm -f ~/.local/bin/vantagemcp
        echo "âœ… Uninstalled vantagemcp from ~/.local/bin"
    else
        echo "âš ï¸  vantagemcp not found in ~/.local/bin"
    fi
"""